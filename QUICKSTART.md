# üöÄ Quickstart ‚Äî Daisy's Med Spa AI Voice Agent

Complete setup guide for a **brand-new machine**. Follow every step in order.

---

## Prerequisites ‚Äî What you need before starting

| Requirement | Where to get it |
|---|---|
| Python 3.11+ | [python.org/downloads](https://www.python.org/downloads/) |
| Git | [git-scm.com](https://git-scm.com/downloads) |
| A LiveKit Cloud account | [cloud.livekit.io](https://cloud.livekit.io) |
| A Sarvam AI API key | [app.sarvam.ai](https://app.sarvam.ai) |
| An OpenAI API key | [platform.openai.com/api-keys](https://platform.openai.com/api-keys) |
| A Supabase project | [app.supabase.com](https://app.supabase.com) |
| A Cal.com account | [app.cal.com](https://app.cal.com) |
| A Telegram Bot (for notifications) | Create via [@BotFather](https://t.me/BotFather) |

---

## Step 1 ‚Äî Install Python 3.11+

### Mac
```bash
# Install Homebrew first (if not installed)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Install Python 3.11
brew install python@3.11

# Verify
python3 --version   # Should show Python 3.11.x or higher
```

### Windows
1. Go to [python.org/downloads](https://www.python.org/downloads/)
2. Download Python 3.11 or newer
3. Run the installer ‚Äî **check "Add Python to PATH"**
4. Open Command Prompt and verify: `python --version`

### Linux (Ubuntu / Debian)
```bash
sudo apt update
sudo apt install python3.11 python3.11-venv python3-pip -y
python3.11 --version
```

---

## Step 2 ‚Äî Clone the repository

```bash
git clone https://github.com/toprmrproducer/InboundAIVoice.git
cd InboundAIVoice
```

---

## Step 3 ‚Äî Create a virtual environment

A virtual environment keeps all packages isolated from your system Python.

### Mac / Linux
```bash
python3.11 -m venv .venv
source .venv/bin/activate
```

### Windows
```powershell
python -m venv .venv
.venv\Scripts\activate
```

> ‚úÖ You'll know it worked when your prompt shows `(.venv)` at the start.

To deactivate later: just type `deactivate`.

---

## Step 4 ‚Äî Install dependencies

```bash
pip install --upgrade pip
pip install -r requirements.txt
```

This installs everything: LiveKit Agents, Sarvam AI, OpenAI, FastAPI, Supabase, pytz, etc.

> ‚è≥ First install takes ~2‚Äì3 minutes.

---

## Step 5 ‚Äî Set up environment variables

Copy the example file:

### Mac / Linux
```bash
cp .env.example .env
```

### Windows
```powershell
copy .env.example .env
```

Now open `.env` in any text editor and fill in **every value**:

```env
# LiveKit ‚Äî from cloud.livekit.io ‚Üí your project ‚Üí Settings
LIVEKIT_URL=wss://your-project.livekit.cloud
LIVEKIT_API_KEY=APIxxxxxxxxxxxxxxxx
LIVEKIT_API_SECRET=your_livekit_api_secret

# OpenAI
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Sarvam AI
SARVAM_API_KEY=sk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Cal.com ‚Äî from app.cal.com/settings/developer/api-keys
CAL_API_KEY=cal_live_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CAL_EVENT_TYPE_ID=1234567   # Your event type ID from Cal.com

# Supabase ‚Äî from app.supabase.com ‚Üí Settings ‚Üí API
SUPABASE_URL=https://your-project-ref.supabase.co
SUPABASE_KEY=your_supabase_anon_key

# Supabase S3 (for call recordings)
SUPABASE_S3_ACCESS_KEY=your_access_key_id
SUPABASE_S3_SECRET_KEY=your_secret_access_key
SUPABASE_S3_ENDPOINT=https://your-project-ref.supabase.co/storage/v1/s3
SUPABASE_S3_REGION=ap-south-1

# Telegram ‚Äî create bot via @BotFather
TELEGRAM_BOT_TOKEN=1234567890:AAxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TELEGRAM_CHAT_ID=123456789

# Call transfer fallback number
DEFAULT_TRANSFER_NUMBER=+91XXXXXXXXXX
```

---

## Step 6 ‚Äî Set up the Supabase database

1. Go to **[app.supabase.com](https://app.supabase.com)** ‚Üí your project
2. Click **SQL Editor** ‚Üí **New Query**
3. Paste and run this SQL:

```sql
-- Create call_logs table
CREATE TABLE IF NOT EXISTS call_logs (
    id               bigint generated by default as identity primary key,
    created_at       timestamp with time zone default timezone('utc', now()) not null,
    phone_number     text,
    caller_name      text,
    duration_seconds integer,
    transcript       text,
    summary          text,
    recording_url    text,
    caller_email     text,
    tts_voice        text
);

ALTER TABLE call_logs ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Enable all actions for service role"
    ON call_logs FOR ALL USING (true);
```

---

## Step 7 ‚Äî Set up Supabase Storage (call recordings)

1. Go to **Supabase ‚Üí Storage ‚Üí New Bucket**
2. Name: `call-recordings` | Set to **Private** | Create
3. Go to **Storage ‚Üí Settings ‚Üí S3 Access ‚Üí Generate new access key**
4. Copy the `Access Key ID` and `Secret Access Key` into your `.env`
5. Run this SQL in the SQL Editor to make recordings publicly readable:

```sql
INSERT INTO storage.buckets (id, name, public)
VALUES ('call-recordings', 'call-recordings', true)
ON CONFLICT (id) DO UPDATE SET public = true;

CREATE POLICY "Public read recordings" ON storage.objects
  FOR SELECT USING (bucket_id = 'call-recordings');

CREATE POLICY "Service role write recordings" ON storage.objects
  FOR INSERT WITH CHECK (bucket_id = 'call-recordings');
```

---

## Step 8 ‚Äî Run the agent

Make sure your virtual environment is active (`(.venv)` in prompt), then:

### Terminal 1 ‚Äî AI Voice Agent
```bash
# Development mode (detailed logs, auto-reload)
python agent.py dev

# OR Production mode
python agent.py start
```

Wait for: `INFO: registered worker [outbound-caller]` ‚Äî agent is live ‚úÖ

### Terminal 2 ‚Äî Dashboard UI
Open a **second terminal** in the same folder, activate the venv again, then:
```bash
python ui_server.py
```

Dashboard is now at: **[http://localhost:8000](http://localhost:8000)**

---

## Step 9 ‚Äî Make a test outbound call

Open a **third terminal**, activate venv, then:
```bash
python make_call.py --to +91XXXXXXXXXX
```
Replace with your real phone number including country code.

---

## Troubleshooting

| Problem | Fix |
|---|---|
| `ModuleNotFoundError` | Run `pip install -r requirements.txt` with venv active |
| `UnboundLocalError` on startup | Check your `.env` ‚Äî a required key is missing |
| No audio on calls | Verify `SARVAM_API_KEY` is correct |
| Booking not saving | Check `SUPABASE_URL` and `SUPABASE_KEY` in `.env` |
| No recordings | Check `SUPABASE_S3_*` env vars and that the bucket exists |
| Agent not registered | Verify `LIVEKIT_URL`, `LIVEKIT_API_KEY`, `LIVEKIT_API_SECRET` |

---

## Deploying to Coolify / Server

1. Push your code to GitHub
2. In Coolify: create a new app ‚Üí connect your GitHub repo
3. Add all `.env` values as **Environment Variables** in Coolify
4. Set the start command to: `supervisord -c supervisord.conf`
5. Deploy ‚Äî both the agent and UI server start automatically

---

## Key files

| File | Purpose |
|---|---|
| `agent.py` | Main AI voice agent |
| `ui_server.py` | Dashboard web UI (FastAPI) |
| `config.json` | Agent settings (editable via UI) |
| `db.py` | Supabase database helpers |
| `calendar_tools.py` | Cal.com booking integration |
| `notify.py` | Telegram notification sender |
| `make_call.py` | Trigger outbound calls manually |
| `supervisord.conf` | Process manager config (production) |
| `requirements.txt` | All Python dependencies |
| `.env.example` | Template for environment variables |
| `supabase_setup.sql` | One-time database setup SQL |
